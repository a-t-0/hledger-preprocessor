# Hledger .csv bank statement preprocessor for hledger-flow

## Tests

```sh
python -m pytest
```

## Developer

```bash
conda env create --file environment.yml
conda activate hledger_preprocessor

pre-commit install
pre-commit autoupdate
pre-commit run --all
```

## Publish pip package

Install the pip package locally with:

```bash
rm -r build
python -m build
pip install -e .
```

Upload the pip package to the world with:

```bash
rm -r build
python -m build
python3 -m twine upload dist/\*
```

## Sphinx documentation

To generate the documentation ensure the pip package is installed locally, such
that the documentation is able to import its Python files.

```bash
rm -r build
python -m build
pip install -e .
```

Then build the documentation with::

```sh
cd docs
pip install -r requirements.txt
make html
```

You can now see all your auto-generated Sphinx documentation in:
[docs/build/html/index.html](docs/build/html/index.html). This repository
auto-generates the Sphinx documentation for all your Python files using the
[/docs/source/conf.py](/docs/source/conf.py) file.

### Additional manual documentation

- The [docs/source/index.rst](docs/source/index.rst) is autogenerated and
  contains the main page and documentation file-structure.
- You can also add additional manual documentation in Markdown format as files in:

```
docs/source/manual_documenation/your_manual_documentation_filename.md
docs/source/manual_documenation/another_manual_documentation_filename.md
```

and then adding those filepaths into the `docs/source/manual.rst` file like:

```rst
Handwritten Documentation
=========================
.. toctree::
   :maxdepth: 2

   manual_documenation/your_manual_documentation_filename.md
   another_manual_documentation_filename.md
```

## Ubuntu hledger-flow installation instructions

Source: https://github.com/apauley/hledger-flow/blob/master/CONTRIBUTING.org#build-the-project
This pip package is intended to be used by
[this fork](https://github.com/a-t-0/hledger-flow/) of the hledger-flow repository.

0. Install [stack](https://docs.haskellstack.org/en/stable/):

```sh
curl -sSL https://get.haskellstack.org/ | sh
```

1. Install prerequiesite package:

```sh
sudo apt-get install libgmp-dev
```

2. Build the repo with:

```sh
stack test --interleaved-output --pedantic
stack install
```

4. Add to path

```sh
echo 'export PATH=$PATH:~/.local/bin' >> ~/.bashrc
source ~/.bashrc
```

5. Create a starting directory with some `.csv` file you downloaded from your bank.

```sh
mkdir -p import/<account holder>/<bank>/<account type>/1-in/2024
```

This structure is hardcoded/required by `hledger-flow`
e.g.

```sh
mkdir -p import/barry/revolut/checking/1-in/2025
```

6. Copy your `<bank transactions>.csv` into that directory like:

```sh
cp blockrise.csv import/alice/uniswap/crypto/1-in/filename_doesnt_matter.csv
```

7. Copy the `createRules` and `preprocess` script into the `<account type>` directory, and make them runnable:

```sh
cp createRules import/barry/revolut/checking/createRules
chmod +x createRules
cp preprocess import/barry/revolut/checking/preprocess
chmod +x preprocess
```

8. Copy the `CONSTANTS.SH` file into the root of your finance repository:

```sh
cp CONSTANTS.sh /path_that_contains_the_import_dir/CONSTANTS.sh
```

9. Run the `hledger-flow import` command.

## LLM Installers

```sh
sudo apt install build-essential
sudo apt install gcc-12 g++-12
conda install libgcc # for fasttext model.
nvidia-smi # SHould say yes you can NVIDEA.

# Download cuda from website:
# https://developer.nvidia.com/cuda-downloads?target_os=Linux&target_arch=x86_64&Distribution=Ubuntu&target_version=24.04&target_type=deb_local
# For my configuration I got commands:
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2404/x86_64/cuda-ubuntu2404.pin
sudo mv cuda-ubuntu2404.pin /etc/apt/preferences.d/cuda-repository-pin-600
wget https://developer.download.nvidia.com/compute/cuda/12.6.3/local_installers/cuda-repo-ubuntu2404-12-6-local_12.6.3-560.35.05-1_amd64.deb
sudo dpkg -i cuda-repo-ubuntu2404-12-6-local_12.6.3-560.35.05-1_amd64.deb
sudo cp /var/cuda-repo-ubuntu2404-12-6-local/cuda-*-keyring.gpg /usr/share/keyrings/
sudo apt-get update
sudo apt-get -y install cuda-toolkit-12-6

sudo apt-get install -y nvidia-open
```
